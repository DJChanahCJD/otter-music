# Plan: Fix router.tsx and Related Issues

## Status
- [x] Analyze `useMusicStore` and `useHistoryStore` to identify missing properties.
- [x] Analyze `MusicPlaylistView` props.
- [x] **Store Update**: Add `isFullScreenPlayer` state to `useMusicStore`.
- [x] **Refactor**: Create `src/routes/RouteWrappers.tsx` and move all route components there to fix Fast Refresh issues.
- [x] **Refactor**: Update `src/router.tsx` to use the new wrappers and clean up code.
- [x] **Verification**: Ensure no linter errors remain.

## Details

### 1. Update `useMusicStore`
- Added `isFullScreenPlayer` (boolean) and `setIsFullScreenPlayer` (function) to `MusicState` interface and implementation.
- This is necessary because `RootLayout` in `router.tsx` uses this state to control the full-screen player and handle the back button.

### 2. Create `src/routes/RouteWrappers.tsx`
- Moved the following components from `router.tsx`:
    - `SearchRoute`
    - `FavoritesRoute`
    - `PlaylistDetailRoute`
    - `MineRoute`
    - `LocalMusicRoute`
    - `QueueRoute`
    - `HistoryRoute` (formerly `HistoryRouteImpl`)
    - `SettingsRoute`
- **Fixes applied during move**:
    - Correctly imported `useHistoryStore` for history logic.
    - Fixed `onRemove` type mismatch in `QueueRoute` and `HistoryRoute` by wrapping the call: `(track) => remove(track.id)`.
    - Added navigation back logic to `PlaylistDetailRoute` when a playlist is deleted.
    - Removed unused variables (`createPlaylist`, `renamePlaylist`, `deletePlaylist` in `MineRoute`).

### 3. Update `src/router.tsx`
- Imported route components from `src/routes/RouteWrappers.tsx`.
- Removed unused imports and variables.
- Kept `RootLayout` and `router` configuration.
- `RootLayout` now correctly gets `isFullScreenPlayer` from `useMusicStore`.
